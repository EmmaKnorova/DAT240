@page
@model TarlBreuJacoBaraKnor.webapp.Pages.OrderOverviewModel

@{
    ViewData["Title"] = "My Orders";
}

<div class="container mt-5">
    <h2 class="mb-4 text-center">My Orders</h2>

    <div class="d-flex justify-content-center mb-4">
        <button id="activeTab" class="btn btn-primary mx-2">Active Orders</button>
        <button id="pastTab" class="btn btn-outline-secondary mx-2">Order History</button>
    </div>

    <div id="activeOrdersCard" class="card shadow-sm p-3">
        <h4>Active Orders</h4>
        @if (Model.ActiveOrders.Any())
        {
            <ul class="list-group list-group-flush">
                @foreach (var order in Model.ActiveOrders)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Order </strong> – @order.Status  
                            <br />
                            @order.OrderDate.DateTime.ToLongTimeString(), @order.Location?.Building @order.Location?.RoomNumber
                        </div>
                        <div>
                            <form method="post" class="m-0">
                            <input type="hidden" name="orderId" value="@order.Id" />
                            <button type="submit" class="btn btn-primary btn-sm rounded-pill shadow-sm d-flex align-items-center">
                                <span class="me-2"><i class="bi bi-eye"></i></span> View Details
                            </button>
                        </form>
                        </div>
                    </li>
                }
            </ul>
        }
        else
        {
            <p>No active orders.</p>
        }
    </div>

    <div id="pastOrdersCard" class="card shadow-sm p-3 d-none">
        <h4>Order history</h4>
        @if (Model.PastOrders.Any())
        {
            <ul class="list-group list-group-flush">
                @foreach (var order in Model.PastOrders)
                {
                    <li class="list-group-item">
                        <strong>Order #@order.Id</strong> – @order.Status  
                        <br />
                        @order.Location?.Building
                    </li>
                    <div>
                        <form method="post" class="m-0">
                            <input type="hidden" name="orderId" value="@order.Id" />
                            <button type="submit" class="btn btn-primary btn-sm rounded-pill shadow-sm d-flex align-items-center">
                                <span class="me-2"><i class="bi bi-eye"></i></span> View Details
                            </button>
                        </form>
                    </div>
                }
            </ul>
        }
        else
        {
            <p>No past orders.</p>
        }
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <script>
        const activeTab = document.getElementById("activeTab");
        const pastTab = document.getElementById("pastTab");
        const activeCard = document.getElementById("activeOrdersCard");
        const pastCard = document.getElementById("pastOrdersCard");

        function launchConfetti(direction = 'center') {
            let originX = 0.5;
            if (direction === 'left') originX = 0.2;
            if (direction === 'right') originX = 0.8;

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { x: originX, y: 0.6 },
                colors: ['#007bff', '#28a745', '#ffc107', '#dc3545']
            });
        }

        activeTab.addEventListener("click", () => {
            activeCard.classList.remove("d-none");
            pastCard.classList.add("d-none");
            activeTab.classList.replace("btn-outline-secondary", "btn-primary");
            pastTab.classList.replace("btn-primary", "btn-outline-secondary");
            launchConfetti('left');
        });

        pastTab.addEventListener("click", () => {
            pastCard.classList.remove("d-none");
            activeCard.classList.add("d-none");
            pastTab.classList.replace("btn-outline-secondary", "btn-primary");
            activeTab.classList.replace("btn-primary", "btn-outline-secondary");
            launchConfetti('right');
        });
    </script>
}
