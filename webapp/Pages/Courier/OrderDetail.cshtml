@page "{id:Guid}"
@using System.Globalization
@using TarlBreuJacoBaraKnor.webapp.Core.Domain.Ordering
@model TarlBreuJacoBaraKnor.webapp.Pages.Courier.OrderDetailModel
@{
    Layout = "/Pages/Courier/Shared/_Courier_Layout.cshtml";
    ViewData["Title"] = "Order Details";
}

<h2>@ViewData["Title"]</h2>

@if (Model._order == null)
{
    <p>Order not found.</p>
}
else
{
    <dl class="row">
        <dt class="col-sm-2">Order ID</dt>
        <dd class="col-sm-10">@Model._order.Id</dd>

        <dt class="col-sm-2">Customer</dt>
        <dd class="col-sm-10">@Model._order.Customer?.Name</dd>

        <dt class="col-sm-2">Order Date</dt>
        <dd class="col-sm-10">@Model._order.OrderDate.ToString("yyyy-MM-dd HH:mm")</dd>

        <dt class="col-sm-2">Location</dt>
        <dd class="col-sm-10">@Model._order.Location?.Building</dd>

        <dt class="col-sm-2">Order Status</dt>
        <dd class="col-sm-10">@Model._order.Status</dd>

        <dt class="col-sm-2">Notes</dt>
        <dd class="col-sm-10">@Model._order.Notes</dd>
    </dl>



    <h3>Items in Order</h3>

    @if (Model._order.OrderLines == null || !Model._order.OrderLines.Any())
    {
        <p>No items in this order.</p>
    }
    else
    {
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Item Name</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Total Price</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var line in Model._order.OrderLines)
            {
                <tr>
                    <td>@line.FoodItemName</td>
                    <td>@line.Amount</td>
                    <td>@(line.Price.ToString("N2") + " NOK")</td>
                    <td>@((line.Amount * line.Price).ToString("N2") + " NOK")</td>
                </tr>
            }
            </tbody>

        </table>
        <div class="text-end mt-3" style="font-size: 1.5rem;">
            <strong>Total Price: </strong>
            @(Model._order.OrderLines.Sum(line => line.Amount * line.Price).ToString("N2") + " NOK")

        </div>

        <form method="post" class="mt-3 d-flex align-items-center">
            <input type="hidden" asp-for="OrderId" value="@Model.OrderId" />

            @{
                string buttonText = Model._order.Status switch
                {
                    Status.Submitted => "Accept Order",
                    Status.Being_picked_up => "Change status to: On the way!",
                    Status.On_the_way => "Change status to: Delivered",
                    _ =>  ""
                };
            }

            @if (buttonText != "")
            {
                <button type="submit" class="btn btn-primary btn-sm">@buttonText</button>
            }
        </form>
    }
}
